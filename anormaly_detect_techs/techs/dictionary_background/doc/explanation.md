背景辞書（Background Dictionary）を用いる方法は、主に **Representation）** という理論に基づいています。

「正常な背景は、あらかじめ用意した『正常パッチの切り抜き（辞書）』をいくつか組み合わせれば再現できるはずだ」という仮定を利用する手法です。代表的なものをいくつか紹介します。


### 1. スパース表現ベースの検知 (SRD: Sparse Representation-based Detector)

RX Detectorの発展形として非常によく使われる手法です。

* **仕組み**:
1. 正常画像から小さなパッチを大量に抜き出し、それを行列として並べた「辞書 」を作ります。
2. 検査したい画素（ターゲット）を、この辞書  にあるパッチの「線形結合（重み付き合計）」で再現しようと試みます。
3. **判定**: 辞書にあるものをどう組み合わせても再現できない（再構成誤差が大きい）場合、その画素は「異常」とみなされます。


* **特徴**: 統計量（平均・分散）ではなく「実在するパターン」で比較するため、複雑なテクスチャ背景に非常に強いです。


### 2. 局所辞書 (Local Dictionary / Dual Window)

画像全体で一つの辞書を作るのではなく、ターゲットの「すぐ周り」から辞書を作る方法です。

* **仕組み**:
ターゲット画素の周囲に「内側の窓（ターゲット領域）」と「外側の窓（背景領域）」を設定し、**外側の窓に含まれる画素だけで辞書を構築**します。
* **メリット**: 場所によって明るさや模様が変わる画像（屋外の監視カメラ、複雑な構造物など）でも、その場所ごとの「今の背景」に即座に適応できます。


### 3. スパース再構成ベースのディープラーニング (MemAE / MemBank)

「辞書」の概念をニューラルネットワークに組み込んだ現代的な手法です。

* **Memory-augmented Autoencoder (MemAE)**:
通常のAutoencoderは、異常なものまで無理やり復元してしまうことがありますが、MemAEは「正常な特徴を記録したメモリ（辞書）」を経由しないと復元できないように設計されています。
* **PatchCore (Memory Bank)**:
学習済みのCNNで抽出した「正常なパッチ特徴」を巨大な辞書（メモリバンク）として保存します。推論時は、入力パッチが辞書内のどのパッチとも似ていなければ異常と判定します。現在、実務で最も精度が高い手法の一つです。


### 4. ロバスト主成分分析 (RPCA: Robust PCA)

あなたが以前から学んでいるこの手法も、実は「辞書」の特殊な形と見なせます。

* **仕組み**:
行列  において、低ランク成分  は「画像全体で共通して使われる少数の基底ベクトル（＝辞書）」の組み合わせでできています。
* **視点**: 辞書を明示的に作るのではなく、データの中から **「共通の辞書（L）」と「辞書に載っていないゴミ（S）」を同時に見つけ出す** 作業をしていると言えます。


### 各手法の使い分け

| 手法 | 辞書の正体 | 向いているケース |
| --- | --- | --- |
| **SRD** | 正常パッチの集合 | 複雑なテクスチャ（布・紙など）のキズ |
| **Local Dictionary** | 周辺画素 | 刻々と変化する背景（屋外・動画） |
| **PatchCore** | 深層学習の特徴ベクトル | 製造ラインの高精度検品 |
| **RPCA** | 低ランク基底 | 静止した背景からの物体抜き出し |

## CRD
異常検知における **CRD (Collaborative Representation-based Detector)** は、先ほど紹介したスパース表現（SRD）の親戚のような手法で、ハイパースペクトル画像や複雑なテクスチャの異常検知において非常に強力な手法です。

一言でいうと、 **「周囲の画素たちが『協力（Collaborative）』して中心の画素を再現できるか？」** をテストする手法です。

### 1. CRDの核心的な考え方

CRDは、 **「正常な画素であれば、その周囲にある他の正常な画素たちの『線形結合（重み付き合計）』で簡単に表現できるはずだ」** という前提に立っています。

* **正常な場所**: 周りの画素と似たような性質を持っているため、周りの画素を適当に混ぜ合わせれば、自分自身の値をほぼ完璧に再現できます。
* **異常な場所**: 周囲の画素（背景）とは異なる性質を持っているため、周りの画素をどう組み合わせても、自分自身をうまく再現できず、大きな「誤差」が生まれます。


### 2. SRD（スパース表現）との決定的な違い

「辞書を使って再現する」という点はSRDと同じですが、数学的な制約（ノルム）が異なります。

* **SRD (Sparse)**: 辞書の中から「ごく少数（スパース）」のパッチを選んで再現しようとします（$L_1$ ノルム最小化）。計算が非常に重いのが欠点です。
* **CRD (Collaborative)**: 辞書のパッチを「全員で協力して（全員に少しずつ重みをつけて）」再現しようとします（$L_2$ ノルム最小化）。
* **メリット**:  $L_2$ ノルム（最小二乗法に近い計算）を用いるため、行列演算だけで解くことができ、SRDよりも圧倒的に高速です。さらに、背景が滑らかな場合はSRDよりも高い精度を出すことが知られています。


### 3. 実装のステップ：Dual Window（二重窓）

CRDは通常、ターゲット画素の周囲に2つの窓を設定して計算します。

1. **ターゲット領域（内窓）**: 異常かどうかを判定したい中心部。
2. **背景領域（外窓）**: 辞書（背景のサンプル）として使う領域。内窓と外窓の間の画素を「辞書」として利用します。
3. **近似計算**: 背景領域の画素ベクトル $D$ と、ターゲット画素 $y$ に対して、$y \approx D \alpha$ となる重み $\alpha$ を計算します。
4. **異常スコア**: 再現しきれなかった誤差 $\|y - D \alpha\|^2$ がそのまま異常スコアになります。


### 4. CRDのメリットと弱点

* **メリット**:
* **計算が速い**: 逆行列計算ベースなので、リアルタイム処理に向いています。
* **局所適応**: 画像全体の統計ではなく、その瞬間の「お隣さん」と比較するため、背景が場所ごとに変化しても精度が落ちません。


* **弱点**:
* **異常が密集している場合**: 外窓（辞書領域）に異常画素が混じってしまうと、異常を異常で再現できてしまうため、検知漏れが発生します（これを防ぐために「ガード窓」を設けます）。



### まとめ：なぜCRDが注目されるのか

あなたがこれまで見てきた **RPCA** は「画像全体の構造」を捉えるのが得意ですが、**CRD** は「局所的な違和感」を捉えるのが非常に得意です。

そのため、**「RPCAで大まかな背景を消した後の残差画像に対し、CRDを適用して微細なキズを浮き彫りにする」**といったコンビネーションも非常によく使われます。





