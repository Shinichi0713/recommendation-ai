## CRDを解くステップ

ターゲット画素 $y$ に対して異常スコアを算出するまでの手順は、以下の5つのステップで構成されます。

1. データの正規化（Preprocessing）

数値計算を安定させるため、ターゲット画素 $y$ および背景辞書 $D$ の各ベクトル（列）を正規化します。
各ベクトルをそのL2ノルム（長さ）で割り、単位ベクトルにします。これにより、明るさの変化の影響を抑え、純粋な「成分の構成比（色やスペクトルの形）」で比較できるようになります。

列ベクトルをL2ノルムで削っていき、単位ベクトルにする。

明るさ影響を抑えて、成分の構成比を比較できるようにする。

2. 相関行列の計算背景辞書 

$D$（サイズ：$d \times n$）から、背景画素同士の類似度を示す行列を作ります。計算式： $D^T D$これにより $n \times n$ （背景画素数 × 背景画素数）の行列が得られます。

1. 二重窓（Dual Window）による空間サンプリング

まず、注目しているターゲット画素 $(x, y)$ を中心に、2つの同心円状の正方形（窓）を設定します。
- 内窓 ($W_{in} \times W_{in}$): ガード窓。ターゲットとその周辺（異常の広がり）を除外する範囲。
- 外窓 ($W_{out} \times W_{out}$): 背景サンプリング窓。背景データを収集する範囲。
 
__数学的な抽出条件__

座標 $(i, j)$ にある画素が辞書 $D$ に採用される条件は以下の通りです。

$$\max(|x-i|, |y-j|) \leq \frac{W_{out}-1}{2}$$

かつ

$$\max(|x-i|, |y-j|) > \frac{W_{in}-1}{2}$$


