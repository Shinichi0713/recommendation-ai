RPCA（Robust Principal Component Analysis）のように、反復計算（アルゴリズムのループ）を用いて背景成分  と異常（スパース）成分  を分離する手法では、 **「最適化が正しく進んでいるか」「いつ計算を止めるべきか」** を判断するために複数の指標をモニタリングします。

主に以下の4つの観点から指標をチェックするのが一般的です。


### 1. 収束の度合い（Convergence Error）

最も基本的で重要な指標です。前ステップの解と現在のステップの解がどれくらい変化したかを測定します。

* **再構成誤差 (Relative Error)**:
元の画像 $M$ と、現在の推定値 $L + S$ の差をモニタリングします。

$$\text{Error} = \frac{\|M - (L + S)\|_F}{\|M\|_F}$$

（$\| \cdot \|_F$ はフロベニウスノルム）
この値が設定した閾値（例：$10^{-7}$）を下回った時に「収束」とみなします。
この値が設定した閾値（例：）を下回った時に「収束」とみなします。
* **変数の変化量 (Variable Change)**:

$L$ や $S$ 自体が前ステップからどれだけ動いたかを見ます。これが急激に減少しなくなるポイントが、最適化の「安定期」です。

---

### 2. ランクとスパース性のトレードオフ

RPCAは「$L$ のランクを低く保ちつつ、$S$ をいかにスカスカ（スパース）にするか」というバランスを探る作業です。

* **$L$ の有効ランク (Effective Rank of $L$)**:

反復ごとに $L$ の特異値（Singular Values）を計算します。特異値が急激に減衰し、少数の主要な値だけに集中していく様子をモニタリングします。
* **$S$ の密度 (Density / Cardinality of $S$)**:

$S$ 成分のうち、非ゼロ（または微小値以上の値）を持つ画素の割合を記録します。
> **分析ポイント**: 最適化が進むにつれ、この密度が徐々に下がり、特定の異常箇所だけに値が集中していくのが理想的な挙動です。



---

### 3. 双対ギャップ (Duality Gap)

数学的に厳密な収束を保証したい場合に使用されます。

* **内容**: 主問題（$L$ と $S$ の最小化）と、その双対問題の解の差を計算します。
* **意味**: 理論上、最適解ではこの差が 0 になります。この値が小さくなるほど、アルゴリズムが「真の最適解」に近い場所にいることを示します。

---

### 4. 拡張ラグランジュ関数（ALM）のペナルティ項

RPCAの実装によく使われる **IALM (Inexact Augmented Lagrange Multiplier)** 拘束条件 $M - L - S = 0$ を守らせるための「罰金（ペナルティ）」を課します。

* **$\mu$ (Penalty Parameter) の推移**:

反復ごとに増加させていく重み係数 $\mu$ を記録します。この値が大きくなるにつれ、$M = L + S$ という制約がより厳格に守られるようになります。
* **残差の推移**:

$M - (L + S)$ のノルムが $\mu$ の増加に伴って滑らかに減少しているかを確認します。

---

### 実務でのモニタリング画面（イメージ）

もしモニタリングツールを作るなら、以下の4画面を並べるのがベストです。

| 指標 | グラフの動き | 異常のサイン |
| --- | --- | --- |
| **Rel. Error** | 右肩下がりに減衰 | 途中で横ばいになる（局所解へのトラップ） |
| **Rank of ** | 一定値で安定 | ランクがいつまでも高い（背景が複雑すぎ） |
| **Density of ** | 急降下して安定 | 密度が高いまま（ノイズを拾いすぎ） |
| **Objective Value** | 徐々に減少 | 激しく上下する（学習率/ステップ幅が大きすぎ） |

### 次のステップへのアドバイス

RPCAの最適化がうまくいかない（異常が見えない）場合、**「収束する前に止まっている」**のか、それとも**「パラメータ（）が不適切で、全てが  または  に吸い込まれている」**のかを、これらの指標で見極めることができます。

現在、反復回数は何回程度で設定されていますか？もし収束が遅い場合は、加速手法（ADM等）の導入を検討するのも手ですよ。