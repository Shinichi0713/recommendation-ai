最適化（Optimization）の世界は非常に奥が深いですが、その根底にあるのは「限られたリソースの中で、最善の結果を導き出す」というシンプルな目的です。

数学や工学、あるいはビジネスの文脈で最適化を理解するために、特に重要な概念と、事実上の「公理」として扱われる考え方を整理の上、問題の具体例で説明してみます。

![1770440764663](image/README/1770440764663.png)

## 概念

最適化を行う上で重要な概念について整理します。

### 1. 最適化の3要素（定式化の基本）

どんな最適化問題も、まずは以下の3つの要素に分解して考えることから始まります。これらを定義できないと、最適化はスタートしません。

* **意思決定変数（Variables）**: 自分がコントロールできる値（例：生産量、広告予算、移動ルート）。
* **目的関数（Objective Function）**: 最大化したいもの（利益、効率）や、最小化したいもの（コスト、誤差、時間）。
* **制約条件（Constraints）**: 守らなければならないルールや限界（予算上限、物理的なスペース、納期）。

### 2. 重要な公理・基本原理

厳密な数学的公理というよりは、実務や理論において「前提」とされる強力な考え方です。

#### 最適性の原理 (Principle of Optimality)

リチャード・ベルマンが提唱した動的計画法の核心です。

> 「最適政策の性質として、初期の状態と決定が何であれ、その結果生じる状態に関して、残りの決定もまた最適政策を構成していなければならない」

簡単に言えば、 **「全体の最短ルートは、その途中のどの区間を切り取っても最短ルートになっている」** という考え方です。

#### 局所最適と大域最適 (Local vs. Global Optima)

最適化において最も注意すべき概念です。

* **局所最適 (Local Optimum)**: 周辺と比較して一番良い状態（「井の中の蛙」状態）。
* **大域最適 (Global Optimum)**: 全体の中で本当に一番良い状態。

多くのアルゴリズムは「勾配（坂道）」を降りますが、複雑な問題では「偽の谷（局所解）」にハマってしまうことがよくあります。

この局所の最適化≠大域最適という関係が最適化でついてまわる課題になります。

![1770436642083](image/README/1770436642083.png)

### 3. 数理的な重要概念

#### 凸性 (Convexity)

最適化において「凸（とつ）であること」は非常に大きな恩恵です。

* **凸集合・凸関数**: 関数が「お椀型」をしている場合、 **「局所最適 ＝ 大域最適」** であることが保証されます。
* 逆に、凸でない問題（非凸問題）は、現代のAIや深層学習の分野でも最大の難所の一つです。

#### 双対性 (Duality)

一つの最適化問題（主問題）には、必ずそれと表裏一体の関係にある別の問題（双対問題）が存在するという考え方です。

* 例えば「利益を最大化する」問題の裏には、「資源の価値を最小化する」という視点が隠れています。
* これを利用することで、元の問題が解きにくい時に、視点を変えて効率的に解を導き出すことができます。

### 4. 現実的な制約：トレードオフ

最適化を理解する上で避けて通れないのが「あちらを立てればこちらが立たず」の精神です。

* **パレート最適 (Pareto Optimality)**: 誰の状況も悪化させることなしには、誰かの状況を改善することができない状態。
* **計算量と精度のトレードオフ**: 完璧な正解（厳密解）を求めようとすると計算が一生終わらない場合、現実的な時間で「そこそこ良い答え（近似解）」を探す必要があります。

## 具体的な問題

実際にビジネスや工学で非常によく使われる **「線形計画法」** という最適化の問題を解いてみようと思います。

### 問題：ジュース工場の生産最適化

読者の方は一旦、ジュース工場の店長だとしていください。
リンゴとオレンジを使って、「特製ミックス」と「濃厚ブレンド」の2種類のジュースを作っています。在庫のフルーツをどう配分すれば、 **売上を最大化** できるかを考えてみます。

#### 1. 意思決定変数（あなたが決めること）

* $x$ ：特製ミックスの生産量（杯）
* $y$ ：濃厚ブレンドの生産量（杯）

#### 2. 制約条件（守らなければならないルール）

現在、手元にある材料の在庫には限りがあります。

* **リンゴの在庫**: 特製ミックス1杯に100g、濃厚ブレンド1杯に200g使います。在庫は合計で **2,000g** です。
* **オレンジの在庫**: 特製ミックス1杯に200g、濃厚ブレンド1杯に100g使います。在庫は合計で **2,000g** です。
* **非負制約**: 生産量はマイナスにはなりません（$x \ge 0, y \ge 0$）。

#### 3. 目的関数（最大化したいもの）

* **売上**: 特製ミックスは1杯 **500円**、濃厚ブレンドは1杯 **400円** で売れます。
* この売上の合計  $z = 500x + 400y$  を最大にしてください。

### 問題

1. 制約条件を数式で表してください。（例：$100x + 200y \le 2000$ など）
2. $x$ と $y$ をそれぞれ何杯ずつ作れば、売上が最大になりますか？
3. **その時の最大売上は何円ですか？**

### 問題の解法

#### 制約条件の数式化

__1. 「単位」を揃える__

数式を作る時の鉄則は、 **左側（使う量）と右側（在庫量）の単位を一致させる** ことです。
今回はリンゴ、オレンジの重さ[g]に統一されています。

* **左辺（Left-Hand Side）**: 実際に消費する量
* **右辺（Right-Hand Side）**: 使える限界量（キャパシティ）

__2. リンゴの制約__

今回問題に設定されたリンゴに関する制約条件は **「使ったリンゴの合計は、在庫の2000gを超えてはいけない」** です。

* $100x$: 「特製ミックス」を $x$ 杯作るときに使うリンゴの量です。
  （1杯100g × $x$ 杯）
* $200y$: 「濃厚ブレンド」を $y$ 杯作るときに使うリンゴの量です。
  （1杯200g × $y$ 杯）
* $+$（プラス）: 2種類のジュースで使うリンゴを全部合わせるという意味です。
* $\le$（不等号）: 「〜以下」という意味です。在庫ぴったり（$=$）でもいいし、余らせても（$<$）いいけれど、在庫を超えることは物理的に不可能なのでこの記号を使います。

結果、以下が与えられます。

$$
100x + 200y \le 2000
$$

__3. オレンジの制約も同じ考え方__

オレンジについても全く同じロジックで組み立てます。

- 特製ミックス1杯に200g → $200x$
- 濃厚ブレンド1杯に100g → $100y$
- 在庫は2000g → $\le 2000$

これを合わせると $200x + 100y \le 2000$ となり、100で割ると $2x + y \le 20$ になります。

__4. 個数はマイナスはない__

最後に、数学の世界には「マイナス」が存在するため、現実世界のルールを付け加える必要があります。
これは **「ジュースの生産量は、最低でも0杯以上（マイナスにはならない）」** という当たり前の条件です。

$$
x \ge 0, y \ge 0
$$

#### 最適化

「（特製ミックス）と （濃厚ブレンド）を何杯ずつ作るのがベストか？」を導き出すプロセスは、今回は **「2つの直線の交点」** を探す作業に集約されます。

__ステップ1：グラフで「動ける範囲」を可視化する__

まず、2つの制約条件をグラフ（直線）として描きます。

1. リンゴの線: $x + 2y = 20$

- $x$ が 0 のとき、$y = 10$
- $y$ が 0 のとき、$x = 20$

2. オレンジの線: $2x + y = 20$

* $x$ が 0 のとき、$y = 20$
* $y$ が 0 のとき、$x = 10$

この2本の線と、縦軸・横軸で囲まれた「内側のエリア」が、あなたが実際に作ることができるジュースの組み合わせ（実行可能領域）です。

![1770439910617](image/README/1770439910617.png)

__ステップ2：なぜ「交点」が答えなのか？__

ここが最適化の面白いところです。
今回の目的は 売上 $z = 500x + 400y$ を最大にすること です。

* 特製ミックス（500円）の方が、濃厚ブレンド（400円）より単価が高いですね。
* だからといって特製ミックスばかり作ろうとすると、オレンジの在庫が先に切れてしまいます（$x=10$ までしか作れません）。
* 逆に濃厚ブレンドばかり作ろうとすると、リンゴの在庫が先に切れます（$y=10$ までしか作れません）。

一番効率が良いのは、**「リンゴもオレンジも使い切るポイント」**、つまり2つの条件がぶつかる **交点** であることが多いのです。

__ステップ3：連立方程式で交点を求める__

与えられた連立方程式を解くと解は

$x = 6.67$杯, $y = 6.67$杯

ここで杯といってるくらいなので、少数はふさわしいとは言い切れません。

この場合、解を満たす範囲内で、最適解近辺を探索することになります。

- \((6,7)\) の場合: \(500(6)+400(7)=3000+2800=5800\)
- \((7,6)\) の場合: \(500(7)+400(6)=3500+2400=5900\)
- \((6,6)\) の場合: \(500(6)+400(6)=3000+2400=5400\)
- \((7,7)\) の場合: \(7+2(7)=21>20\) となり、在庫不足（NG）

上記計算より $x = 7$杯, $y = 6$杯 の時が最適と得られました。

#### 最適な売り上げ

上記計算より \5,900が売り上げの最大値です。

## 最適化アルゴリズム

最適化アルゴリズムは、問題の性質（線形か非凸か、連続か離散かなど）によって使い分ける必要があります。

現代のエンジニアリングやAI開発で特によく使われるものを、大きく4つのカテゴリーに分けて整理しました。

### 1. 線形・凸最適化アルゴリズム（確実な正解を求める）

問題が「凸（お椀型）」であれば、計算機は確実に「世界で一番良い答え（大域最適解）」を見つけることができます。

* **単体法 (Simplex Method)**:
  先ほどの「ジュース工場」のグラフのように、領域の「角（頂点）」を次々に移動して最適解を探す古典的かつ強力な手法です。
* **内点法 (Interior Point Method)**:
  領域の「中」を突っ切って最適解に近づく手法です。非常に大規模な線形計画問題で単体法より高速に動作することがあります。

### 2. 勾配ベースのアルゴリズム（AI・深層学習の主力）

関数の「傾き（勾配）」を計算し、坂を転がり落ちるように最適値を探す手法です。

* **勾配降下法 (Gradient Descent)**:
  現在の地点の傾きを見て、最も急な下り坂の方向に一歩進む、AI学習の基本中の基本です。
* **Adam / RMSprop**:
  単純な勾配降下法に「慣性（モーメンタム）」や「学習率の自動調整」を加えた進化系です。現在のディープラーニングの標準となっています。

### 3. メタヒューリスティクス（複雑・巨大な問題に挑む）

数式で綺麗に解けない「非凸」な問題や、組み合わせが爆発的に多い問題に対し、「完璧ではないが、そこそこ良い答え」を現実的な時間で見つける手法です。

* **遺伝的アルゴリズム (Genetic Algorithm)**:
  生物の進化（交配、突然変異、生存競争）を模倣します。配送ルートの最適化や、アンテナの形状設計などに使われます。
* **焼きなまし法 (Simulated Annealing)**:
  金属の冷却プロセスを模倣します。最初は大きくランダムに動き（温度が高い）、徐々に動きを小さくして安定した解に落ち着かせます。局所最適（偽の谷）から抜け出すのに有効です。

### 4. 離散・組み合わせ最適化アルゴリズム

「0か1か」といった、変数が飛び飛びの値をとる問題（整数計画法など）に使われます。

* **分枝限定法 (Branch and Bound)**:
  「杯数は整数」という制約がある場合、問題を枝分かれ（分枝）させて、見込みのない枝を切り捨て（限定）ながら探索します。
* **動的計画法 (Dynamic Planning)**:
  大きな問題を小さな部分問題に分割して解く手法です。最短経路問題（カーナビの検索など）の基本アルゴリズム「ダイクストラ法」もこの一種です。

### アルゴリズムの選び方マトリックス

| 問題の特徴                     | 推奨アルゴリズム    | 主な用途              |
| ------------------------------ | ------------------- | --------------------- |
| **直線的・制約が明確**   | 単体法、内点法      | 予算配分、生産計画    |
| **微分可能・大量データ** | 勾配降下法 (Adam等) | AI、画像認識の学習    |
| **ルールが複雑・非定型** | 遺伝的アルゴリズム  | 施設配置、シフト作成  |
| **最短ルート・段階的**   | 動的計画法          | カーナビ、パズル、SEO |

## 総括

今回は最適化の概念と、概念を理解するための具体的な問題、問題解法を扱ってみました。
最適化は数式化と、解法両方が非常に奥の深い分野です。
コンピュータで意思決定をする場合に、結構な頻度で出てきますし、実は最適化を使っていたということも多いです。
今回記事、是非ご参考下さい。
